(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{579:function(t,s,n){"use strict";n.r(s);var e=n(4),a=Object(e.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[t._v("2021年了，还在使用Http？你OUT了！赶紧使用起Https吧！")])]),n("p",[t._v("要配置HTTPS，并且使HTTP强制跳转到HTTPS，总体来看需要下面步骤：")]),t._v(" "),n("ol",[n("li",[t._v("申请HTTPS证书")]),t._v(" "),n("li",[t._v("上传证书到服务器")]),t._v(" "),n("li",[t._v("配置Nginx HTTPS证书，以支持HTTPS")]),t._v(" "),n("li",[t._v("配置HTTP强制跳转到HTTPS")])]),t._v(" "),n("p",[t._v("下面以阿里云证书配置https的"),n("code",[t._v("blog.616team.com")]),t._v("为例，对每个步骤进行详细讲解：")]),t._v(" "),n("h2",{attrs:{id:"_1-申请https证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-申请https证书"}},[t._v("#")]),t._v(" 1. 申请HTTPS证书")]),t._v(" "),n("p",[t._v("首先进入"),n("a",{attrs:{href:"https://yundun.console.aliyun.com/?spm=5176.6660585.774526198.1.bcda6bf8XKiNOf&p=cas#/certExtend",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里云证书资源包"),n("OutboundLink")],1),t._v("，购买"),n("strong",[t._v("免费证书扩容包")]),t._v("，选择20个证书（这样是免费的）")]),t._v(" "),n("p",[t._v("点击证书申请")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/cert_apply1.png",alt:"证书申请"}})]),t._v(" "),n("p",[t._v("选择单域名，免费版SSL，一次，点击确定")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/cert_apply2.png",alt:"证书申请"}})]),t._v(" "),n("p",[t._v("上面步骤会消费一次证书，并且在下方的"),n("strong",[t._v("证书管理")]),t._v("中新增一条未申请的证书，我们点击证书申请")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/cert_apply3.png",alt:"证书申请"}})]),t._v(" "),n("p",[t._v("在证书申请页面，填写基本信息，其中证书绑定域名填写我们需要设置HTTPS的域名，填写完成点击下一步")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/cert_apply4.png",alt:"证书申请"}})]),t._v(" "),n("p",[t._v("在证书验证信息页面，我们需要验证域名是我们所有，所以需要我们去"),n("strong",[t._v("云解析DNS")]),t._v("中配置一条解析记录，按照页面上给出的信息填写。如果我们的域名也在阿里云上管理，且是当前账号下，那么这一步系统会自动为我们创建一条解析记录，就不用我们手动去添加了。一切完成之后点击验证，如果成功，将会提示域名验证成功。接下来点击提交审核。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/cert_apply5.png",alt:"证书申请"}})]),t._v(" "),n("h2",{attrs:{id:"_2-上传证书到服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-上传证书到服务器"}},[t._v("#")]),t._v(" 2. 上传证书到服务器")]),t._v(" "),n("p",[t._v("通常，审核是秒通过的，所以这时候你可能就会在"),n("strong",[t._v("证书管理")]),t._v("中看到已签发的证书。我们点击下载")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/cert_apply6.png",alt:"下载证书"}})]),t._v(" "),n("p",[t._v("在弹出的"),n("strong",[t._v("证书下载页面")]),t._v("可以下载各种服务器类型的证书，因为我们使用的是nginx，所以我们下载nginx的证书")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/cert_apply7.png",alt:"下载证书"}})]),t._v(" "),n("p",[t._v("下载之后我们得到一个"),n("code",[t._v("zip")]),t._v("压缩包，解压之后得到两个文件，一个是"),n("code",[t._v(".key")]),t._v("，一个是"),n("code",[t._v(".pem")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/download_cert.png",alt:"解压证书"}})]),t._v(" "),n("p",[t._v("我们将这两个文件上传到nginx服务器")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/upload_cert.png",alt:"上传证书"}})]),t._v(" "),n("h2",{attrs:{id:"_3-配置nginx-https证书-以支持https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置nginx-https证书-以支持https"}},[t._v("#")]),t._v(" 3. 配置Nginx HTTPS证书，以支持HTTPS")]),t._v(" "),n("p",[t._v("我使用的nginx是docker实例，将上面的"),n("code",[t._v("ssl")]),t._v("目录挂载到了"),n("code",[t._v("/etc/nginx/ssl")]),t._v("目录,这个"),n("code",[t._v("ssl")]),t._v("目录在docker容器内与"),n("code",[t._v("nginx.conf")]),t._v("同级，所以后面的配置我可以直接使用相对路径"),n("code",[t._v("ssl/***")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/nginx_https_config1.png",alt:"挂载证书"}})]),t._v(" "),n("p",[t._v("编辑"),n("code",[t._v("nginx.conf")]),t._v("文件，添加下面代码：")]),t._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("  server {\n   listen 443 ssl; # 1.1版本后这样写\n   server_name blog.616team.com; #填写绑定证书的域名\n   ssl_certificate ssl/5227774_blog.616team.com.pem; # 指定证书的位置\n   ssl_certificate_key ssl/5227774_blog.616team.com.key; # 指定证书的位置\n   ssl_session_timeout 5m;\n   ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #按照这个协议配置\n   ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;#按照这个套件配置\n   ssl_prefer_server_ciphers on;\n   location / {\n     proxy_pass http://www.616team.com:8896; # 实际应用的域名+端口\n   }\n }\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("p",[t._v("重启nginx，访问"),n("a",{attrs:{href:"https://blog.616team.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.616team.com"),n("OutboundLink")],1),t._v("，可以看到页面打开了，是HTTPS协议，并且域名前面有一把小锁，说明域名是安全的。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/nginx_https_view_https1.png",alt:"访问HTTPS"}})]),t._v(" "),n("h2",{attrs:{id:"_4-配置http强制跳转到https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置http强制跳转到https"}},[t._v("#")]),t._v(" 4. 配置HTTP强制跳转到HTTPS")]),t._v(" "),n("p",[t._v("虽然我们操作到以上步骤，已经能够正常访问到https服务了。但是如果我们访问"),n("a",{attrs:{href:"http://blog.616team.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://blog.616team.com"),n("OutboundLink")],1),t._v("，我们会发现报500了。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/nginx_https_view_http1.png",alt:"访问HTTP"}})]),t._v(" "),n("p",[t._v("这是因为我们只配置了https，但是这里访问的是http，这对用户非常不友好。一半用户在输入网址时，并不会带上http或者https协议，默认会使用http。为了解决这个问题，我们可以在nginx上配置http强制跳转到https，这样用户不输入https协议，甚至输入了http协议，都会由nginx跳转到https上。我们继续对"),n("code",[t._v("nginx.conf")]),t._v("添加以下代码：")]),t._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("  server {\n    listen 80;\n    server_name blog.616team.com; # 填写要强制跳转https的域名\n    rewrite ^(.*)$  https://$server_name$1 permanent;\n  }\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("p",[t._v("重启nginx之后我们再次访问"),n("a",{attrs:{href:"http://blog.616team.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://blog.616team.com"),n("OutboundLink")],1),t._v("，发现自动跳转到https了。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/nginx_https_view_http2.png",alt:"访问HTTPS"}})]),t._v(" "),n("br"),t._v(" "),n("hr"),t._v(" "),n("br"),t._v(" "),n("Vssue",{attrs:{title:t.$title}})],1)}),[],!1,null,null,null);s.default=a.exports}}]);