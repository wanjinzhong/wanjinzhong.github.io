(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{558:function(s,t,a){"use strict";a.r(t);var n=a(4),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"基本结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本结构"}},[s._v("#")]),s._v(" 基本结构")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("┝━━src\n┝━━vars\n┕━━resources\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("src")]),s._v(": 必须。类似于Java的源代码目录结构，执行流水线式，此目录将被添加到类路径中。")]),s._v(" "),a("p",[a("strong",[s._v("vars")]),s._v(': 托管脚本文件，这些脚本文件在"管道"中作为变量公开。')]),s._v(" "),a("p",[a("strong",[s._v("resources")]),s._v(": 允许libraryResource从外部库中使用不走来加载相关联的非Groovy文件。")]),s._v(" "),a("h2",{attrs:{id:"使用share-library"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用share-library"}},[s._v("#")]),s._v(" 使用Share Library")]),s._v(" "),a("p",[s._v("Jenkins的Share Library可以使用外部仓库，jenkins也内建了一个git仓库，所以Share Library也可以使用git内置的内部仓库。这里使用github外部仓库为例。")]),s._v(" "),a("h3",{attrs:{id:"_1-创建share-library仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建share-library仓库"}},[s._v("#")]),s._v(" 1. 创建Share Library仓库")]),s._v(" "),a("p",[s._v("在github上创建Share Library仓库。如"),a("a",{attrs:{href:"https://github.com/wanjinzhong/jenkins_lib_test",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/wanjinzhong/jenkins_lib_test"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"_2-推送代码至share-library"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-推送代码至share-library"}},[s._v("#")]),s._v(" 2. 推送代码至Share Library")]),s._v(" "),a("p",[s._v("按照Share Libray的标准结构将代码推送至上面创建的仓库")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/jenkins_github_share_library_repo1.jpg",alt:""}})]),s._v(" "),a("p",[s._v("其中"),a("code",[s._v("src/org/devops")]),s._v("目录下存在一个"),a("code",[s._v("tools.groovy")]),s._v("文件，文件内容如下：")]),s._v(" "),a("div",{staticClass:"language-groovy line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("devops\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//打印内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("PrintMes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_3-在jenkins上配置share-library"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-在jenkins上配置share-library"}},[s._v("#")]),s._v(" 3. 在Jenkins上配置Share Library")]),s._v(" "),a("p",[s._v("进入"),a("code",[s._v("系统管理>系统配置")]),s._v("，找到"),a("code",[s._v("Global Pipeline Libraries")]),s._v("。新建一个Share Library（"),a("em",[s._v("图片未截完，未截完部分保持默认")]),s._v("）：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/jenkins_share_libaray_new1.jpg",alt:""}})]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[s._v("说明")]),a("p",[a("strong",[s._v("Name")]),s._v(": 重要，以后引用该Share Library库的时候指定的名字。")]),s._v(" "),a("p",[a("strong",[s._v("Default version")]),s._v(": 使用Share Library库的分支名称。注意：github已经将默认"),a("code",[s._v("master")]),s._v("分支重命名为"),a("code",[s._v("main")]),s._v("分支")])]),a("h3",{attrs:{id:"_4-使用share-library"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-使用share-library"}},[s._v("#")]),s._v(" 4. 使用Share Library")]),s._v(" "),a("p",[s._v("在Jenkins job中配置"),a("code",[s._v("pipeline")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-groovy line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Library")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"jenkinslib"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("_")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" tools "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("devops"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tools")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\npipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tagent any\n\toptions "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timestamps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tstages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"Library Test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tsteps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t\tscript "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t\t\ttools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("PrintMes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"Hello Jenkins!!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("其中：")]),s._v(" "),a("ul",[a("li",[s._v("第1行代码引入Share Library，名称即为第三步指定的Name")]),s._v(" "),a("li",[s._v("第3行代码创建"),a("code",[s._v("tools.groovy")]),s._v("类的实例，并赋予"),a("code",[s._v("tools")]),s._v("变量")]),s._v(" "),a("li",[s._v("第14行代码调用"),a("code",[s._v("tools")]),s._v("实例的方法")])]),s._v(" "),a("h3",{attrs:{id:"_5-执行pipeline"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-执行pipeline"}},[s._v("#")]),s._v(" 5. 执行pipeline")]),s._v(" "),a("p",[s._v("观察执行结果：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/jenkins_share_libaray_output1.jpg",alt:""}})]),s._v(" "),a("p",[s._v("从结果中我们可以看出，pipeline首先从github上拉取我们引用的"),a("code",[s._v("jenkinslib")]),s._v(" Share Library库，然后调用库中的方法输出了"),a("code",[s._v("hello Jenkins")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#详解"}},[s._v("#")]),s._v(" 详解")]),s._v(" "),a("h3",{attrs:{id:"加载share-library到pipeline"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载share-library到pipeline"}},[s._v("#")]),s._v(" 加载Share Library到Pipeline")]),s._v(" "),a("p",[s._v("语法")]),s._v(" "),a("div",{staticClass:"language-groovy line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Library")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<libname>[@<verison>]'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("_")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" statement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[s._v("注意")]),a("ul",[a("li",[s._v("未使用import时，必须在注解末尾加下划线（"),a("code",[s._v("_")]),s._v("）")]),s._v(" "),a("li",[s._v("版本可以是仓库的"),a("code",[s._v("tag")]),s._v("名或者分支名等")])])]),a("p",[s._v("比如：")]),s._v(" "),a("div",{staticClass:"language-groovy line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//加载库的默认版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Library")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'myLib'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("_")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//加载库的tag 2.0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Library")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"myLib@2.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("_")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//加载库的dev分支")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Library")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"myLib@dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("_")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//加载多个库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Library")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"myLib1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"yourLib@2.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("_")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//带导入语句（不需要下划线）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Library")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"myLib"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("neil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("br"),s._v(" "),a("hr"),s._v(" "),a("br"),s._v(" "),a("Vssue",{attrs:{title:s.$title}})],1)}),[],!1,null,null,null);t.default=r.exports}}]);