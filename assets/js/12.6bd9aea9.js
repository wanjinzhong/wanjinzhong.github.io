(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{525:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("最近在项目中需要使用到直播平台。在搜索开源直播平台后，发现有如下几个不错的开源项目：")]),s._v(" "),t("ol",[t("li",[s._v("nginx-rtmp")]),s._v(" "),t("li",[s._v("illuspas/node-media-server")]),s._v(" "),t("li",[s._v("gwuhaolin/livego")])]),s._v(" "),t("p",[s._v("本文将记录gwuhaolin/livego的使用方式。")]),s._v(" "),t("blockquote",[t("p",[s._v("本文转载自"),t("a",{attrs:{href:"https://blog.csdn.net/weixin_39998006/article/details/106683184",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/weixin_39998006/article/details/106683184"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),t("h3",{attrs:{id:"简单高效的直播服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简单高效的直播服务器"}},[s._v("#")]),s._v(" 简单高效的直播服务器：")]),s._v(" "),t("ul",[t("li",[s._v("安装和使用非常简单；")]),s._v(" "),t("li",[s._v("纯 Golang 编写，性能高，跨平台；")]),s._v(" "),t("li",[s._v("支持常用的传输协议、文件格式、编码格式；")])]),s._v(" "),t("h3",{attrs:{id:"支持的传输协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#支持的传输协议"}},[s._v("#")]),s._v(" 支持的传输协议")]),s._v(" "),t("ul",[t("li",[s._v("RTMP")]),s._v(" "),t("li",[s._v("AMF")]),s._v(" "),t("li",[s._v("HLS")]),s._v(" "),t("li",[s._v("HTTP-FLV")])]),s._v(" "),t("h3",{attrs:{id:"支持的容器格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#支持的容器格式"}},[s._v("#")]),s._v(" 支持的容器格式")]),s._v(" "),t("ul",[t("li",[s._v("FLV")]),s._v(" "),t("li",[s._v("TS")])]),s._v(" "),t("h3",{attrs:{id:"支持的编码格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#支持的编码格式"}},[s._v("#")]),s._v(" 支持的编码格式")]),s._v(" "),t("ul",[t("li",[s._v("H264")]),s._v(" "),t("li",[s._v("AAC")]),s._v(" "),t("li",[s._v("MP3")])]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("直接下载编译好的二进制文件后，在命令行中执行。")])]),s._v(" "),t("li",[t("p",[s._v("从 Docker 启动")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker run -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1935")]),s._v(":1935 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(":7001 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(":7002 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8090")]),s._v(":8090 -d gwuhaolin/livego\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("Docker compose (docker-compose.yml)")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("\nservices:\n  livego:\n    image: gwuhaolin/livego\n    container_name: livego\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8090")]),s._v(":8090\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(":7001\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(":7002\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1935")]),s._v(":1935\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("从源码编译")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("下载源码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/gwuhaolin/livego.git\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("去 livego 目录中 执行")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("go build\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])])])]),s._v(" "),t("h2",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("启动服务：执行 "),t("code",[s._v("livego")]),s._v(" 二进制文件启动 livego 服务（docker无需）")])]),s._v(" "),t("li",[t("p",[s._v("访问 "),t("a",{attrs:{href:"http://localhost:8090/control/get?room=movie",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:8090/control/get?room=movie"),t("OutboundLink")],1),s._v(" 获取一个房间的 "),t("code",[s._v("channelkey")]),s._v("("),t("code",[s._v("channelkey")]),s._v("用于推流，"),t("code",[s._v("movie")]),s._v("用于播放)。"),t("code",[s._v("movie")]),s._v("存在即获取，不存在就生成并返回")])]),s._v(" "),t("li",[t("p",[s._v("推流: 通过RTMP协议推送视频流到地址 "),t("a",{attrs:{href:"rtmp://localhost:1935/%7Bappname%7D/%7Bchannelkey%7D"}},[s._v("rtmp://localhost:1935/{appname}/{channelkey}")]),s._v(" ("),t("strong",[s._v("appname默认是live")]),s._v("), 例如：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("使用 ffmpeg:")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("ffmpeg -re -i demo.flv -c copy -f flv rtmp://localhost:1935/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("appname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("channelkey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("使用OBS")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-1252535357.cos.ap-chengdu.myqcloud.com/blog/obs_rtmp.png",alt:"OBS推流"}})])])])]),s._v(" "),t("li",[t("p",[s._v("播放: 支持多种播放协议，播放地址如下:")]),s._v(" "),t("ul",[t("li",[s._v("RTMP: "),t("a",{attrs:{href:"rtmp://localhost:1935/%7Bappname%7D/movie"}},[s._v("rtmp://localhost:1935/{appname}/movie")])]),s._v(" "),t("li",[s._v("FLV: "),t("a",{attrs:{href:"http://127.0.0.1:7001/%7Bappname%7D/movie.flv",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:7001/{appname}/movie.flv"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("HLS: "),t("a",{attrs:{href:"http://127.0.0.1:7002/%7Bappname%7D/movie.m3u8",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:7002/{appname}/movie.m3u8"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("检查连接状态（推流和拉流的信息）: "),t("a",{attrs:{href:"http://127.0.0.1:8090/stat/livestat",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8090/stat/livestat"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("pull接口示例: "),t("a",{attrs:{href:"http://127.0.0.1:8090/control/pull?&oper=start&app=live&name=123456&url=rtmp://192.168.16.136/live/123456",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8090/control/pull?&oper=start&app=live&name=123456&url=rtmp://192.168.16.136/live/123456"),t("OutboundLink")],1),s._v(" "),t("ul",[t("li",[s._v("oper可以传入两种状态: "),t("code",[s._v("start")]),s._v("/"),t("code",[s._v("stop")])])])]),s._v(" "),t("li",[s._v("push接口示例: "),t("a",{attrs:{href:"http://127.0.0.1:8090/control/push?&oper=start&app=live&name=123456&url=rtmp://192.168.16.136/live/123456",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8090/control/push?&oper=start&app=live&name=123456&url=rtmp://192.168.16.136/live/123456"),t("OutboundLink")],1),s._v("，功能跟pull相似，甚至于可以说一模一样")]),s._v(" "),t("li",[s._v("reset接口示例: "),t("a",{attrs:{href:"http://127.0.0.1:8090/control/reset?room=ROOM_NAME",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8090/control/reset?room=ROOM_NAME"),t("OutboundLink")],1),s._v(" 具体没试过，不过推测应该是重新生成channelkey")]),s._v(" "),t("li",[s._v("delete接口示例: "),t("a",{attrs:{href:"http://127.0.0.1:8090/control/delete?room=ROOM_NAME",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8090/control/delete?room=ROOM_NAME"),t("OutboundLink")],1),s._v("删除房间")])])])]),s._v(" "),t("h2",{attrs:{id:"所有配置项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有配置项"}},[s._v("#")]),s._v(" 所有配置项:")]),s._v(" "),t("h3",{attrs:{id:"livego-h"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#livego-h"}},[s._v("#")]),s._v(" ./livego  -h")]),s._v(" "),t("p",[s._v("Usage of ./livego:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('--api_addr string       HTTP管理访问监听地址 (default ":8090")\n--config_file string    配置文件路径 (默认 "livego.yaml")\n--flv_dir string        输出的 flv 文件路径 flvDir/APP/KEY_TIME.flv (默认 "tmp")\n--gop_num int           gop 数量 (default 1)\n--hls_addr string       HLS 服务监听地址 (默认 ":7002")\n--hls_keep_after_end    Maintains the HLS after the stream ends\n--httpflv_addr string   HTTP-FLV server listen address (默认 ":7001")\n--level string          日志等级 (默认 "info")\n--read_timeout int      读超时时间 (默认 10)\n--rtmp_addr string      RTMP 服务监听地址 (默认 ":1935")\n--write_timeout int     写超时时间 (默认 10)\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),t("p",[s._v("其实livego是支出两种存储方式，一种是localCache，另一种是redis,想启用redis就需要在配置文件中增加两项配置，还有一个就是jwt鉴权，这两个功能都是需要阅读源码才能知道，略微有些坑")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # Logger level")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # # 支持的级别 panic,fatal,error,warn,info,debug,trace")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# level: info")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # FLV Options")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# flv_dir: "./tmp"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# httpflv_addr: ":7001"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # RTMP Options")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# rtmp_addr: ":1935"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# read_timeout: 10")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# write_timeout: 10")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # HLS Options")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# hls_addr: ":7002"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# #想启用jwt需要打开以下三项注释")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # # algorithm: 仅支持 以下三种算法 默认HS256算法")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # # # HMAC签名方法： HS256 HS384 HS512")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # # # RSA签名方法： RS256，RS384，RS512")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # # # ECDSA签名方法： ES256，ES384，ES512")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#jwt:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- secret: xxx")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  algorithm: xxx")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # API Options")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# api_addr: ":8090"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# #想启用redis需要打开以下两项注释,不打开默认启用本地存储")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redis_addr: 127.0.0.1:6379")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redis_pwd:")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("appname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" live\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("live")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hls")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br")])]),t("br"),s._v(" "),t("hr"),s._v(" "),t("br"),s._v(" "),t("Vssue",{attrs:{title:s.$title}})],1)}),[],!1,null,null,null);a.default=n.exports}}]);